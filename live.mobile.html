<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <title>Cuadrantes de turnos · Móvil</title>

  <!-- PWA (sólo registrará SW en http/https) -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1520">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="icon" href="img/turnos_icon.png" />
  <link rel="stylesheet" href="styles.css?v=TS" />
  <link rel="stylesheet" href="styles.mobile.css?v=TS" />
  <style>
    /* Cabecera y botones compactos */
    .app-header{position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;background:#0e1720;color:#f5f7fa;padding:10px 12px}
    .app-header .brand{display:flex;align-items:center;gap:10px}
    .app-header .brand img{width:24px;height:24px;border-radius:6px}
    .app-header .title{font:700 16px/1 system-ui}
    .actions{display:flex;gap:6px}
    .btn{appearance:none;border:1px solid #253040;background:#142130;color:#e6edf5;border-radius:999px;padding:6px 10px;font:600 12px system-ui}
    .btn.primary{background:#0b67ff;border-color:#0b67ff;color:#fff}
    main.wrap{padding:12px}
    @media (min-width:768px){ main.wrap{padding:20px} }
    /* Drawer de filtros compacto */
    #drawer{max-width:560px;margin:0 auto;position:fixed;left:0;right:0;bottom:0;transform:translateY(100%);transition:transform .25s ease;background:#fff;border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -10px 30px rgba(0,0,0,.15)}
    #drawer header{padding:14px 14px 0;font:700 14px system-ui;color:#123}
    #drawer .f-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:12px}
    #drawer select,#drawer input{height:36px;font-size:14px;padding:6px 10px;border:1px solid #d6e0ea;border-radius:10px}
    #drawer .f-actions{display:flex;gap:8px;justify-content:flex-end;padding:0 12px 12px}
    /* Logo compacto dentro de la cabecera de tarjeta */
    .weekHead .weekLogo{width:48px;height:48px;border-radius:10px;object-fit:contain}
    /* Oculta cualquier banner heredado fuera del bloque */
    .wrap > img:first-child{display:none !important; max-height:0 !important;}
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="img/turnos_icon.png" alt="">
      <div class="title">Cuadrantes de turnos</div>
    </div>
    <div class="actions">
      <button id="btnPrev" class="btn">← Semana</button>
      <button id="btnToday" class="btn">Hoy</button>
      <button id="btnNext" class="btn">Semana →</button>
      <button id="btnFilters" class="btn primary">Filtros</button>
    </div>
  </header>

  <main class="wrap">
    <div id="monthly-summary-container" role="region" aria-live="polite"></div>
  </main>

  <!-- Drawer de filtros -->
  <section id="drawer" aria-hidden="true">
    <header>Filtros</header>
    <div class="f-grid">
      <div>
        <label style="display:block;font:600 12px system-ui;color:#345;margin-bottom:6px">Hotel</label>
        <select id="f-hotel"></select>
      </div>
      <div>
        <label style="display:block;font:600 12px system-ui;color:#345;margin-bottom:6px">Semana (lunes)</label>
        <input id="f-week" type="date">
      </div>
    </div>
    <div class="f-actions">
      <button id="f-cancel" class="btn">Cancelar</button>
      <button id="f-apply" class="btn primary">Aplicar</button>
    </div>
  </section>

  <!-- Datos -->
  <script src="data.js?v=TS"></script>
  <script src="data.ausencias.js?v=TS"></script>

  <!-- Adaptador móvil -->
  <script src="plantilla_mobile_adapter.js?v=TS"></script>
  <script>
    // Bridges defensivos
    window.MobileTemplate = window.MobileTemplate || {};
    if (!window.MobileTemplate.renderContent && typeof window.renderContent === 'function') {
      window.MobileTemplate.renderContent = window.renderContent;
    }
    if (typeof window.buildFD === 'undefined' && typeof window.buildModel === 'function') {
      window.buildFD = window.buildModel;
    }
  </script>

  <!-- Parches de texto (opcional) -->
  <script src="mobile.patch.js?v=TS"></script>

  <!-- App móvil -->
  <script src="mobile.app.js?v=TS"></script>

  <script>
    // Registro SW (solo http/https)
    if (location.protocol.startsWith('http') && 'serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(()=>{});
    }
  </script>
</body>
</html>
